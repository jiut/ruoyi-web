# 角色选择功能修改验证清单

## ✅ 代码修改验证

### 1. API接口修改 (`src/api/user.ts`)
- [x] 接口路径：`POST /system/user/updateRole` → `PUT /system/user/authRole` ✅
- [x] 请求方法：`post` → `put` ✅
- [x] 参数结构：`{roleId}` → `{userId, roleIds: [Number(roleId)]}` ✅
- [x] 数据类型转换：`Number(roleId)` 转换角色ID为数字 ✅

### 2. 用户Store修改 (`src/store/modules/user/helper.ts`)
- [x] UserInfo接口添加userId字段 ✅
- [x] userId字段类型：`string | number` ✅

### 3. 用户信息获取 (`src/store/modules/user/index.ts`)
- [x] fetchUserInfo方法保存userId ✅
- [x] 从`res.data.user.userId`获取并保存 ✅

### 4. 角色选择页面 (`src/views/role-selection/index.vue`)
- [x] 获取userId：`userStore.userInfo?.userId` ✅
- [x] 参数传递：`updateUserRole(roleId, userId)` ✅
- [x] 用户信息验证：检查userId是否存在 ✅
- [x] 错误处理增强：403权限错误处理 ✅

## 📋 功能测试清单

### 测试环境要求
- [ ] 后端API `/system/user/authRole` 已部署
- [ ] 用户具有相应的角色更新权限
- [ ] 前端开发服务器正常运行

### 基础功能测试
- [ ] 用户注册后登录，自动跳转到角色选择页面
- [ ] 角色选择页面正确显示三个角色卡片
- [ ] 点击角色卡片可以选中（UI状态变化）
- [ ] 点击"确认选择"按钮调用API（无控制台错误）
- [ ] 角色更新成功后跳转到人才模块
- [ ] 用户信息正确更新（角色列表包含新角色）

### 错误场景测试
- [ ] 未选择角色时点击确认：显示"请先选择一个角色"
- [ ] 无userId时：显示"无法获取用户信息，请重新登录"
- [ ] 403权限错误：显示"没有权限修改用户角色"
- [ ] 网络错误：显示相应错误信息
- [ ] API响应错误：显示后端返回的错误信息

### 数据验证测试
- [ ] API请求格式正确：
  ```json
  {
    "userId": 123456789,
    "roleIds": [1932319128081666050]
  }
  ```
- [ ] 角色ID正确转换为数字类型
- [ ] userId正确传递（不为空或undefined）

## 🐛 常见问题排查

### 问题1：角色选择后没有更新
**排查步骤**：
1. 检查浏览器控制台是否有API错误
2. 查看网络面板中API请求参数格式
3. 确认后端返回的响应状态

### 问题2：权限错误
**排查步骤**：
1. 确认用户是否有角色更新权限
2. 检查userId是否正确传递
3. 验证后端权限配置

### 问题3：数据类型错误
**排查步骤**：
1. 确认roleId已转换为数字类型
2. 检查userId类型是否匹配后端要求
3. 验证API请求体格式

## 🔧 调试技巧

### 1. 控制台调试
```javascript
// 在浏览器控制台中检查用户信息
const userStore = useUserStore()
console.log('用户信息:', userStore.userInfo)
console.log('用户ID:', userStore.userInfo?.userId)
console.log('用户角色:', userStore.userInfo?.roles)
```

### 2. 网络请求调试
- 打开浏览器开发者工具
- 查看Network面板
- 找到`/system/user/authRole`请求
- 检查请求参数和响应数据

### 3. API测试
可以使用Postman或curl测试API：
```bash
curl -X PUT "http://your-api-url/system/user/authRole" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "userId": 123456789,
    "roleIds": [1932319128081666050]
  }'
```

## 📊 验证报告模板

```
验证日期：2024-12-19
验证人员：[姓名]
验证环境：[开发/测试/生产]

功能测试结果：
✅ 基础功能：[通过/失败]
✅ 错误处理：[通过/失败]
✅ 数据验证：[通过/失败]

发现问题：
1. [问题描述]
2. [问题描述]

修复建议：
1. [建议描述]
2. [建议描述]

总体评估：[通过/需要修复]
```

## 📞 支持联系

如果在验证过程中遇到问题，请：
1. 检查本清单中的排查步骤
2. 查看相关文档和代码注释
3. 联系开发团队进行支持
