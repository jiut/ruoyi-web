# å‰ç«¯æ—¥æœŸæ ¼å¼ä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**ï¼š`Invalid value for EpochDay (valid values -365243219162 - 365241780471): 1019664000000`

**é—®é¢˜åŸå› **ï¼šå‰ç«¯å‘é€çš„æ˜¯æ¯«ç§’æ—¶é—´æˆ³ `1019664000000`ï¼Œä½†åç«¯ `LocalDate` å­—æ®µæœŸæœ› `yyyy-MM-dd` æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå·¥å…·å‡½æ•°è½¬æ¢ï¼ˆæ¨èï¼‰

**1. åˆ›å»ºæ—¥æœŸæ ¼å¼è½¬æ¢å·¥å…·å‡½æ•°**

```typescript
// utils/dateUtils.ts
/**
 * å°†æ—¶é—´æˆ³æˆ– Date å¯¹è±¡è½¬æ¢ä¸º yyyy-MM-dd æ ¼å¼å­—ç¬¦ä¸²
 * @param value æ—¶é—´æˆ³(æ¯«ç§’) | Dateå¯¹è±¡ | null | undefined
 * @returns yyyy-MM-dd æ ¼å¼å­—ç¬¦ä¸²æˆ– null
 */
export const formatDateForApi = (value: number | Date | string | null | undefined): string | null => {
  if (!value) return null;

  let date: Date;

  if (typeof value === 'number') {
    date = new Date(value);
  } else if (typeof value === 'string') {
    date = new Date(value);
  } else {
    date = value;
  }

  // éªŒè¯æ—¥æœŸæœ‰æ•ˆæ€§
  if (isNaN(date.getTime())) {
    console.warn('Invalid date value:', value);
    return null;
  }

  // è¿”å› yyyy-MM-dd æ ¼å¼
  return date.toISOString().split('T')[0];
};
```

**2. åœ¨æäº¤æ—¶è½¬æ¢æ•°æ®**

```typescript
// è®¾è®¡å¸ˆæ³¨å†Œç»„ä»¶ä¸­
const handleSubmit = async () => {
  // è½¬æ¢æ—¥æœŸå­—æ®µ
  const submitData = {
    ...formData,
    birthDate: formatDateForApi(formData.birthDate),
    graduationDate: formatDateForApi(formData.graduationDate), // å¦‚æœæœ‰è¿™ä¸ªå­—æ®µ
  };

  // ç§»é™¤ç©ºå€¼å­—æ®µ
  Object.keys(submitData).forEach(key => {
    if (submitData[key] === null || submitData[key] === undefined || submitData[key] === '') {
      delete submitData[key];
    }
  });

  try {
    const response = await registerDesigner(submitData);
    // å¤„ç†æˆåŠŸ
    console.log('æ³¨å†ŒæˆåŠŸ:', response);
  } catch (error) {
    // å¤„ç†é”™è¯¯
    console.error('æ³¨å†Œå¤±è´¥:', error);
  }
};
```

### æ–¹æ¡ˆäºŒï¼šæ—¥æœŸé€‰æ‹©å™¨é…ç½®ï¼ˆElement Plusï¼‰

å¦‚æœä½¿ç”¨ Element Plusï¼š

```vue
<template>
  <el-date-picker
    v-model="formData.birthDate"
    type="date"
    placeholder="é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ"
    format="YYYY-MM-DD"
    value-format="YYYY-MM-DD" <!-- å…³é”®ï¼šç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²æ ¼å¼ --
  >
    />
  </el-date-picker>
</template>
```

### æ–¹æ¡ˆä¸‰ï¼šæ—¥æœŸé€‰æ‹©å™¨é…ç½®ï¼ˆNaive UIï¼‰

å¦‚æœä½¿ç”¨ Naive UIï¼š

```vue
<script setup>
const formatDate = (ts: number) => {
  return new Date(ts).toISOString().split('T')[0]
}
</script>

<template>
  <n-date-picker
    v-model:value="formData.birthDate"
    type="date"
    :format="formatDate"
    value-format="yyyy-MM-dd" <!-- å…³é”®ï¼šè®¾ç½®è¾“å‡ºæ ¼å¼ --
  >
    placeholder="é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ"
    />
  </n-date-picker>
</template>
```

### æ–¹æ¡ˆå››ï¼šåŸç”Ÿ input[type="date"] é…ç½®

å¦‚æœä½¿ç”¨åŸç”Ÿ HTML æ—¥æœŸè¾“å…¥ï¼š

```vue
<template>
  <!-- åŸç”Ÿ input[type="date"] é»˜è®¤å°±è¿”å› yyyy-MM-dd æ ¼å¼ -->
  <input
    v-model="formData.birthDate"
    type="date"
    class="custom-input w-full"
  >
</template>
```

## ğŸ”§ å®Œæ•´ç¤ºä¾‹ä»£ç 

```vue
<script setup lang="ts">
import { ref } from 'vue'
import { formatDateForApi } from '@/utils/dateUtils'

// è¡¨å•æ•°æ®
const formData = ref({
  designerName: '',
  birthDate: '',
  gender: '',
  phone: '',
  email: '',
  profession: '',
  workYears: 0,
  skillTags: '[]',
  description: ''
})

// æäº¤å¤„ç†
const handleSubmit = async () => {
  // æ•°æ®é¢„å¤„ç†
  const submitData = {
    designerName: formData.value.designerName,
    birthDate: formatDateForApi(formData.value.birthDate),
    gender: formData.value.gender || undefined,
    phone: formData.value.phone || undefined,
    email: formData.value.email || undefined,
    profession: formData.value.profession || undefined,
    workYears: formData.value.workYears || 0,
    skillTags: formData.value.skillTags || '[]',
    description: formData.value.description || undefined,
  }

  // ç§»é™¤ç©ºå€¼å­—æ®µ
  Object.keys(submitData).forEach((key) => {
    if (submitData[key] === null || submitData[key] === undefined || submitData[key] === '')
      delete submitData[key]

  })

  try {
    const response = await fetch('/designer/register/designer', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(submitData)
    })

    if (response.ok)
      console.log('æ³¨å†ŒæˆåŠŸ')
      // è·³è½¬åˆ°æˆåŠŸé¡µé¢
    else
      console.error('æ³¨å†Œå¤±è´¥:', await response.text())

  }
  catch (error) {
    console.error('ç½‘ç»œé”™è¯¯:', error)
  }
}
</script>

<template>
  <form @submit.prevent="handleSubmit">
    <!-- å§“å - å¿…å¡« -->
    <div>
      <label>å§“å *</label>
      <input
        v-model="formData.designerName"
        type="text"
        required
        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
      >
    </div>

    <!-- å‡ºç”Ÿæ—¥æœŸ - å¯é€‰ -->
    <div>
      <label>å‡ºç”Ÿæ—¥æœŸ</label>
      <input
        v-model="formData.birthDate"
        type="date"
        placeholder="é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ"
      >
    </div>

    <!-- å…¶ä»–å­—æ®µ... -->

    <button type="submit">
      æ³¨å†Œ
    </button>
  </form>
</template>
```

## ğŸ§ª æµ‹è¯•éªŒè¯

**1. éªŒè¯è½¬æ¢å‡½æ•°**

```typescript
// æµ‹è¯•ç”¨ä¾‹
console.log(formatDateForApi(1019664000000)); // è¾“å‡º: "2002-04-25"
console.log(formatDateForApi(new Date('2002-04-25'))); // è¾“å‡º: "2002-04-25"
console.log(formatDateForApi('2002-04-25')); // è¾“å‡º: "2002-04-25"
console.log(formatDateForApi(null)); // è¾“å‡º: null
console.log(formatDateForApi(undefined)); // è¾“å‡º: null
```

**2. éªŒè¯æäº¤æ•°æ®æ ¼å¼**

```json
// æ­£ç¡®çš„æäº¤æ•°æ®æ ¼å¼
{
  "designerName": "è·¯è±ªå¹¿",
  "avatar": "",
  "gender": "2",
  "birthDate": "2002-04-25", // âœ… å­—ç¬¦ä¸²æ ¼å¼ï¼Œä¸æ˜¯æ—¶é—´æˆ³
  "phone": "17671813489",
  "email": "2315544955@qq.com",
  "profession": "ILLUSTRATOR",
  "skillTags": "[]",
  "workYears": 3,
  "description": "123456767890"
}
```

## ğŸ“ ä¿®æ”¹æ¸…å•

- [ ] åˆ›å»º `utils/dateUtils.ts` å·¥å…·æ–‡ä»¶
- [ ] åœ¨è®¾è®¡å¸ˆæ³¨å†Œç»„ä»¶ä¸­å¯¼å…¥å·¥å…·å‡½æ•°
- [ ] ä¿®æ”¹æäº¤å¤„ç†å‡½æ•°ï¼Œä½¿ç”¨ `formatDateForApi` è½¬æ¢æ—¥æœŸ
- [ ] æµ‹è¯•æ—¶é—´æˆ³è½¬æ¢åŠŸèƒ½
- [ ] éªŒè¯åç«¯æ¥å£è°ƒç”¨æˆåŠŸ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç©ºå€¼å¤„ç†**ï¼šç¡®ä¿ç©ºçš„æ—¥æœŸå­—æ®µä¸å‘é€åˆ°åç«¯
2. **æ—¶åŒºé—®é¢˜**ï¼š`toISOString()` ä½¿ç”¨ UTC æ—¶é—´ï¼Œå¯¹äºæ—¥æœŸï¼ˆä¸å«æ—¶é—´ï¼‰å½±å“å¾ˆå°
3. **å…¼å®¹æ€§**ï¼šæ­¤æ–¹æ¡ˆå…¼å®¹æ‰€æœ‰ä¸»æµæ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶
4. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

---

**ä¿®å¤å®Œæˆåï¼ŒåŸé”™è¯¯ `Invalid value for EpochDay` å°†ä¸å†å‡ºç°ã€‚**
