# 人才模块数据源切换功能说明

## 功能概述

人才模块现在支持根据用户登录状态自动切换数据源：
- **未登录时**：使用Mock数据，提供完整的演示体验
- **登录后**：使用后端API，获取真实数据

## 实现原理

### 1. 登录状态检测

创建了 `src/utils/authUtils.ts` 工具文件，提供登录状态检测功能：

```typescript
import { getToken } from '@/store/modules/auth/helper'
import { useUserStore } from '@/store/modules/user'

/**
 * 检测用户是否已登录
 * @returns {boolean} 是否已登录
 */
export function isLoggedIn(): boolean {
  const token = getToken()
  const userStore = useUserStore()

  // 检查是否有有效的token
  if (!token) {
    return false
  }

  // 检查用户信息是否完整（参考TalentUserMenu.vue的逻辑）
  const hasValidUser = !!(userStore.userInfo?.name && userStore.userInfo.name !== '熊猫助手')

  return !!token && hasValidUser
}
```

### 2. 数据源切换逻辑

在每个composable中实现了 `shouldUseMockData()` 函数：

```typescript
// 根据登录状态决定是否使用模拟数据
// 未登录时使用mock数据，登录后使用后端API
const shouldUseMockData = () => {
  // 如果明确设置了环境变量，优先使用环境变量
  if (import.meta.env.VITE_USE_MOCK_DATA === 'true') {
    return true
  }
  if (import.meta.env.VITE_USE_MOCK_DATA === 'false') {
    return false
  }

  // 否则根据登录状态决定
  return !isLoggedIn()
}
```

### 3. 修改的Composables

#### useDesigner.ts
- 修改了数据获取逻辑，根据登录状态选择数据源
- 更新了返回的数据源，动态选择Mock数据或API数据
- 添加了Mock数据的筛选和搜索功能

#### useJob.ts
- 修改了岗位数据获取逻辑
- 支持Mock数据和API数据的无缝切换

#### useSchool.ts
- 修改了院校列表和详情的数据获取逻辑
- 支持Mock数据的院校信息展示

## 环境变量配置

可以通过环境变量强制指定数据源：

```bash
# 强制使用Mock数据
VITE_USE_MOCK_DATA=true

# 强制使用后端API
VITE_USE_MOCK_DATA=false

# 不设置环境变量，则根据登录状态自动切换
```

## Mock数据

### 设计师数据
位置：`src/data/mockDesigners.ts`
包含：
- 5个模拟设计师
- 不同的职业类型（UI设计师、平面设计师、交互设计师）
- 完整的技能标签、工作经历、教育背景、获奖信息

### 岗位数据
位置：`src/data/mockJobs.ts`
包含：
- 多个知名企业的岗位信息
- 完整的岗位描述、要求、薪资等信息

### 院校数据
位置：`src/data/mockSchools.ts`
包含：
- 知名设计院校信息
- 完整的院校详情、专业信息、就业数据等

## 测试方式

可以通过以下方式测试数据源切换功能：

- 在浏览器控制台查看调试信息
- 通过环境变量强制指定数据源进行测试
- 登录/登出时观察数据源的变化

## 使用方式

### 1. 正常使用
用户无需做任何特殊操作，系统会自动根据登录状态选择合适的数据源。

### 2. 开发调试
- 通过环境变量强制指定数据源进行测试
- 在浏览器控制台查看调试信息
- 登录/登出时观察数据源的变化

### 3. 生产部署
- 确保后端API正常运行
- 用户登录后自动切换到真实数据
- 未登录用户仍可浏览Mock数据

## 技术特点

1. **无缝切换**：用户登录/登出时数据源自动切换，无需刷新页面
2. **向后兼容**：不影响现有的API调用逻辑
3. **灵活配置**：支持环境变量强制指定数据源
4. **完整功能**：Mock数据支持筛选、搜索、分页等完整功能
5. **性能优化**：Mock数据响应速度快，提升用户体验

## 注意事项

1. Mock数据仅用于演示，不包含敏感信息
2. 登录后切换到API数据时，可能需要重新加载数据
3. 环境变量优先级高于登录状态检测
4. 建议在生产环境中确保后端API的稳定性

## 未来扩展

1. 可以添加更多的Mock数据
2. 支持数据源的混合使用（部分Mock，部分API）
3. 添加数据源切换的动画效果
4. 支持离线模式的数据缓存
