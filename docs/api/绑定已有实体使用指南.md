# 绑定已有企业或院校使用指南

## 📋 概述

设计师管理模块支持两种身份绑定方式：
1. **注册新实体并绑定**：创建新的企业/院校并自动绑定到当前用户
2. **绑定已有实体**：用户选择系统中已存在的企业/院校进行绑定

本指南主要介绍如何绑定已有的企业或院校。

## 🔄 绑定方式对比

### 注册新实体并绑定（原有方式）
- **适用场景**：企业/院校首次注册系统
- **权限要求**：仅需登录
- **操作流程**：填写完整信息 → 创建实体 → 自动绑定

### 绑定已有实体（新增方式）
- **适用场景**：企业/院校已在系统中，用户需要加入
- **权限要求**：登录 + 验证机制（邀请码/学号等）
- **操作流程**：查找实体 → 验证身份 → 绑定关系

## 🎯 绑定已有企业

### 1. 查看可绑定的企业列表

**接口**: `GET /designer/user/available/enterprises`

**参数**:
- `pageNum` (可选): 页码，默认1
- `pageSize` (可选): 每页大小，默认10  
- `enterpriseName` (可选): 企业名称模糊查询

**示例请求**:
```bash
GET /designer/user/available/enterprises?pageNum=1&pageSize=10&enterpriseName=科技
```

**响应示例**:
```json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "enterpriseId": 1,
                "enterpriseName": "字节跳动科技有限公司",
                "description": "全球领先的移动互联网公司",
                "industry": "互联网",
                "scale": "5000+",
                "address": "北京市海淀区"
            },
            {
                "enterpriseId": 2,
                "enterpriseName": "腾讯科技有限公司",
                "description": "中国领先的互联网增值服务提供商",
                "industry": "互联网",
                "scale": "5000+",
                "address": "深圳市南山区"
            }
        ],
        "total": 2,
        "size": 10,
        "current": 1,
        "pages": 1
    }
}
```

### 2. 绑定到指定企业

**接口**: `POST /designer/user/bind/enterprise`

**参数**:
- `enterpriseId` (必须): 企业ID
- `inviteCode` (可选): 企业邀请码

**示例请求**:
```bash
POST /designer/user/bind/enterprise?enterpriseId=1&inviteCode=INVITE123
```

**响应示例**:
```json
{
    "code": 200,
    "msg": "绑定企业成功",
    "data": null
}
```

**错误情况**:
```json
{
    "code": 500,
    "msg": "用户已绑定企业身份，请先解绑后再绑定",
    "data": null
}
```

## 🏫 绑定已有院校

### 1. 查看可绑定的院校列表

**接口**: `GET /designer/user/available/schools`

**参数**:
- `pageNum` (可选): 页码，默认1
- `pageSize` (可选): 每页大小，默认10
- `schoolName` (可选): 院校名称模糊查询

**示例请求**:
```bash
GET /designer/user/available/schools?pageNum=1&pageSize=10&schoolName=设计
```

**响应示例**:
```json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "records": [
            {
                "schoolId": 1,
                "schoolName": "清华大学美术学院",
                "description": "中国著名的艺术设计院校",
                "schoolType": "公立",
                "level": "985",
                "address": "北京市海淀区清华园1号"
            },
            {
                "schoolId": 2,
                "schoolName": "中央美术学院",
                "description": "中国历史最悠久的美术院校",
                "schoolType": "公立",
                "level": "211",
                "address": "北京市朝阳区花家地南街8号"
            }
        ],
        "total": 2,
        "size": 10,
        "current": 1,
        "pages": 1
    }
}
```

### 2. 绑定到指定院校

**接口**: `POST /designer/user/bind/school`

**参数**:
- `schoolId` (必须): 院校ID
- `studentId` (可选): 学号

**示例请求**:
```bash
POST /designer/user/bind/school?schoolId=1&studentId=2020001234
```

**响应示例**:
```json
{
    "code": 200,
    "msg": "绑定院校成功",
    "data": null
}
```

## 🔐 管理员绑定接口

对于管理员，还提供了直接绑定用户到任意实体的接口：

**接口**: `POST /designer/user/bind`

**权限**: `designer:user:bind`

**参数**:
- `userId` (必须): 用户ID
- `entityType` (必须): 实体类型 (`designer`/`enterprise`/`school`)
- `entityId` (必须): 实体ID

**示例请求**:
```bash
POST /designer/user/bind?userId=123&entityType=enterprise&entityId=1
```

## 📝 使用流程示例

### 场景1：员工加入已有企业

1. **查询企业列表**
   ```bash
   GET /designer/user/available/enterprises?enterpriseName=字节跳动
   ```

2. **选择目标企业** (例如企业ID为1)

3. **绑定企业**
   ```bash
   POST /designer/user/bind/enterprise?enterpriseId=1&inviteCode=HR2024
   ```

4. **验证绑定结果**
   ```bash
   GET /designer/user/enterprise/profile
   ```

### 场景2：学生绑定院校

1. **查询院校列表**
   ```bash
   GET /designer/user/available/schools?schoolName=清华
   ```

2. **选择目标院校** (例如院校ID为1)

3. **绑定院校**
   ```bash
   POST /designer/user/bind/school?schoolId=1&studentId=2020001234
   ```

4. **验证绑定结果**
   ```bash
   GET /designer/user/school/profile
   ```

## ⚠️ 注意事项

### 1. 绑定限制
- 每个用户在同一实体类型下只能绑定一个实体
- 如需切换绑定，必须先解绑当前实体

### 2. 解绑操作
在绑定新实体前，如果已有绑定，需要先解绑：

```bash
# 解绑企业身份
PUT /designer/user/unbind/enterprise

# 解绑院校身份  
PUT /designer/user/unbind/school
```

### 3. 身份验证（待完善）
当前版本的邀请码和学号验证逻辑尚未实现，以下功能在后续版本中会完善：

- **企业邀请码验证**：企业可生成邀请码供员工使用
- **学号验证**：与院校学籍系统对接验证学生身份
- **审批流程**：管理员审批绑定申请

### 4. 权限考虑
- 普通用户只能绑定自己的身份
- 管理员可以为任意用户绑定身份
- 某些敏感操作可能需要额外的验证步骤

## 🔍 查看当前绑定状态

### 获取所有绑定信息
```bash
GET /designer/user/bindings
```

**响应示例**:
```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "bindingId": 1,
            "userId": 123,
            "entityType": "designer",
            "entityId": 456,
            "bindingStatus": "1"
        },
        {
            "bindingId": 2,
            "userId": 123,
            "entityType": "enterprise",
            "entityId": 1,
            "bindingStatus": "1"
        }
    ]
}
```

### 获取具体身份档案
```bash
# 设计师档案
GET /designer/user/designer/profile

# 企业档案
GET /designer/user/enterprise/profile

# 院校档案
GET /designer/user/school/profile
```

## 🚀 前端集成建议

### 1. 企业选择组件
```javascript
// 获取企业列表
const getEnterpriseList = async (params) => {
    const response = await api.get('/designer/user/available/enterprises', { params });
    return response.data;
};

// 绑定企业
const bindEnterprise = async (enterpriseId, inviteCode) => {
    const response = await api.post('/designer/user/bind/enterprise', null, {
        params: { enterpriseId, inviteCode }
    });
    return response.data;
};
```

### 2. 院校选择组件
```javascript
// 获取院校列表
const getSchoolList = async (params) => {
    const response = await api.get('/designer/user/available/schools', { params });
    return response.data;
};

// 绑定院校
const bindSchool = async (schoolId, studentId) => {
    const response = await api.post('/designer/user/bind/school', null, {
        params: { schoolId, studentId }
    });
    return response.data;
};
```

### 3. 绑定状态检查
```javascript
// 检查用户绑定状态
const checkBindingStatus = async () => {
    const response = await api.get('/designer/user/bindings');
    const bindings = response.data.data;
    
    return {
        hasDesigner: bindings.some(b => b.entityType === 'designer'),
        hasEnterprise: bindings.some(b => b.entityType === 'enterprise'),
        hasSchool: bindings.some(b => b.entityType === 'school')
    };
};
```

## 📊 数据库设计

绑定关系通过 `des_user_binding` 表管理：

```sql
CREATE TABLE `des_user_binding` (
    `binding_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '绑定ID',
    `user_id` BIGINT NOT NULL COMMENT '用户ID',
    `entity_type` VARCHAR(20) NOT NULL COMMENT '实体类型（designer/enterprise/school）',
    `entity_id` BIGINT NOT NULL COMMENT '实体ID',
    `binding_status` CHAR(1) DEFAULT '1' COMMENT '绑定状态（0解绑 1绑定）',
    `create_time` DATETIME COMMENT '创建时间',
    `update_time` DATETIME COMMENT '更新时间',
    PRIMARY KEY (`binding_id`),
    UNIQUE KEY `uk_user_entity` (`user_id`, `entity_type`),
    INDEX `idx_user_id` (`user_id`),
    INDEX `idx_entity` (`entity_type`, `entity_id`)
);
```

## 🎯 总结

通过以上接口，用户可以方便地：

1. **浏览系统中的企业和院校**
2. **选择合适的实体进行绑定**
3. **管理自己的身份绑定关系**
4. **在不同身份间切换**

这种设计既保持了系统的灵活性，又确保了数据的一致性和安全性。 